<!DOCTYPE html>
<html>
<head>
<title>StenoBuddy</title>
<script src="lookup.js"></script>
<script src="textLookup.js"></script>
<script src="html2pdf.js"></script>
<script src="1c2.js"></script>
<style>
  body {
    font-family: sans-serif;
  }
  #video-container {
    margin-top: 20px;
  }
</style>
</head>
<body>

<h1>Please select a KC passage</h1>

<select id="volume-select">
  <option value="1">Volume 1</option>
  <option value="2">Volume 2</option>
</select>

<select id="transcription-select">
  </select>

<select id="speed-select">
  <option value="70">70</option>
  <option value="75">75</option>
  <option value="80">80</option>
  <option value="85">85</option>
  <option value="90">90</option>
  <option value="100">100</option>
</select>

<div id="video-container">
  </div>
<div id="paragraphA">
<textarea id="paragraphB" placeholder="Type the matter here" style="width: 100%; height: 300px; font-size: 18px; display: block;"></textarea>
<div id="textBoxC" style="display: none;"></div>
<button onclick="downloadPDF()">Download Result</button>
<script>

  const volumeSelect = document.getElementById('volume-select');
  const transcriptionSelect = document.getElementById('transcription-select');
  const speedSelect = document.getElementById('speed-select');
  const videoContainer = document.getElementById('video-container');

  const transcriptions = {
    1: Array.from({ length: 22 }, (_, i) => `${i + 1}`),
    2: Array.from({ length: 12 }, (_, i) => `${i + 23}`),//only12 vids in 2nd volume
  };

  function populateTranscriptions(volume) {
    transcriptionSelect.innerHTML = ''; // Clear existing options
    const options = transcriptions[volume];
    options.forEach(transcription => {
      const option = document.createElement('option');
      option.value = transcription;
      option.text = transcription;
      transcriptionSelect.appendChild(option);
    });
  }
  
  function updateVideo() {
  const spd = document.getElementById('speed-select').value;
  const tra = document.getElementById('transcription-select').value;
    /*const volume = volumeSelect.value;
    const transcription = transcriptionSelect.value;
    const speed = speedSelect.value;
*/

    videoUrl = urlLookup[parseInt(tra,10)][parseInt(spd,10)];  // Use embed URL
	paragraphA.value = textTable[parseInt(tra,10)];
    videoContainer.innerHTML = `<iframe width="560" height="315" src="${videoUrl}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>`;
  }

  volumeSelect.addEventListener('change', () => {
    populateTranscriptions(volumeSelect.value);
    updateVideo();
  });

  transcriptionSelect.addEventListener('change', updateVideo);
  speedSelect.addEventListener('change', updateVideo);

  // Initialize on load
  populateTranscriptions(volumeSelect.value);
  updateVideo();


function downloadPDF() {
compareParagraphs();
    

    // Get the PDF file name
    const pdfFileName = "Customized Dictation"; // Assuming the document title contains the desired PDF file name

    // Get current date and time
    const currentDate = new Date();
    const day = currentDate.getDate();
    const monthIndex = currentDate.getMonth();
    const year = currentDate.getFullYear();
    const hours = currentDate.getHours();
    const currentMinutes = currentDate.getMinutes(); // Renamed to currentMinutes to avoid conflict
    const ampm = hours >= 12 ? 'PM' : 'AM';
    const formattedHours = hours % 12 || 12; // Convert to 12-hour format
    const formattedMinutes = currentMinutes < 10 ? '0' + currentMinutes : currentMinutes;

    // Array of month names
    const monthNames = [
        "January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"
    ];

    // Format the date
    const formattedDate = `${day} ${monthNames[monthIndex]} ${year},`;

    // Format the time
    const formattedTime = `${formattedHours}:${formattedMinutes} ${ampm}`;

    // Create header content with PDF file name, time taken, and download date
    const headerContent = `
        <div style="text-align: center;">
            <a href="https://stenobuddy.github.io/" style="color: blue; text-decoration: none;">https://stenobuddy.github.io</a>
        </div>
        <div style="text-align: center; margin-top: 5px;">
            Test Date & Time: ${formattedDate} ${formattedTime} <br>
        </div>
    `;

    // Create a container for the header text
    const headerText = document.createElement('div');
    headerText.innerHTML = headerContent;
    headerText.style.textAlign = 'left'; // Align the header text to the left

    // Get the textBoxC element
    const textBoxC = document.getElementById('textBoxC');

    // Insert the header text before any other content in textBoxC
    textBoxC.insertBefore(headerText, textBoxC.firstChild);

    // Convert the HTML element to a PDF using html2pdf library
    html2pdf()
        .from(textBoxC)
        .set({
            margin: 10,
            filename: pdfFileName, // Use the dynamically extracted PDF file name
            jsPDF: {
                unit: 'mm',
                format: 'a4',
                orientation: 'portrait'
            }
        })
        .save();
}

</script>

</body>
</html>